(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e3bc08c"],{1688:function(e,t,a){"use strict";var n=a("8092"),i=a.n(n);i.a},"25f0":function(e,t,a){"use strict";var n=a("6eeb"),i=a("825a"),s=a("d039"),o=a("ad6d"),r="toString",l=RegExp.prototype,c=l[r],d=s((function(){return"/a/b"!=c.call({source:"a",flags:"b"})})),u=c.name!=r;(d||u)&&n(RegExp.prototype,r,(function(){var e=i(this),t=String(e.source),a=e.flags,n=String(void 0===a&&e instanceof RegExp&&!("flags"in l)?o.call(e):a);return"/"+t+"/"+n}),{unsafe:!0})},6301:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.sheetData?a("div",{staticClass:"preview-container"},[a("div",{staticClass:"top"},[e._v(" 显示最新 "),a("span",{staticClass:"value"},[e._v(e._s(e.sheetData.length))]),e._v("条数据，总共 "),a("span",{staticClass:"value"},[e._v(e._s(e.total))]),e._v("条数据 ")]),a("div",{staticClass:"data-container"},[a("a-table",{style:{"word-break":"break-all"},attrs:{"table-layout":"auto",size:"small",rowKey:"index",pagination:!1,"data-source":e.sheetData,columns:e.columns,scroll:{x:1600,y:500}}})],1)]):e._e()},i=[],s=(a("4de4"),a("4160"),a("d81d"),a("b0c0"),a("d3b7"),a("25f0"),a("159b"),{props:["workSheet"],data:function(){return{previewCondition:{fields:[],sql:"",wheres:[],whereType:"condition",linker:"and",order:{name:"",desc:!0}},sheetData:null,total:0}},computed:{columns:function(){var e=this.sheetData,t={};return e.forEach((function(e){for(var a in e){var n=e[a].toString().length||0,i=t[a];(void 0===i||i<n)&&(t[a]=n)}})),this.workSheet.fields.forEach((function(e){e.width=10*t[e.name]+20})),this.workSheet.fields.filter((function(e){return"origin"===e.fieldType})).map((function(e){var t={dataIndex:e.name,title:e.title,width:e.width};return t}))}},created:function(){this.fetchData()},methods:{fetchData:function(){var e=this;this.$axios.post("/workSheet/preview/".concat(this.workSheet.workSheetId),this.previewCondition,{timeout:1e7}).then((function(t){e.sheetData=t.data,e.total=t.total}))}}}),o=s,r=(a("dd2d"),a("2877")),l=Object(r["a"])(o,n,i,!1,null,null,null);t["a"]=l.exports},"6a7e":function(e,t,a){},"6e21":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dashboard-container"},[a("a-row",{attrs:{type:"flex",justify:"center",align:"top",gutter:16}},[a("a-col",{attrs:{xs:{span:7},xl:{span:5},xxl:{span:5}}},[a("div",{staticClass:"catalogue-container"},[a("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[a("a-input",{attrs:{placeholder:"过滤",icon:"FilterOutlined"},model:{value:e.filterValue,callback:function(t){e.filterValue=t},expression:"filterValue"}},[a("a-icon",{attrs:{slot:"suffix",type:"filter"},slot:"suffix"})],1),a("a-dropdown",{attrs:{trigger:["click"]}},[a("a-menu",{attrs:{slot:"overlay"},on:{click:e.handleMenuClick},slot:"overlay"},[a("a-menu-item",{key:"文件夹"},[a("a-icon",{attrs:{type:"folder"}}),e._v("创建文件夹 ")],1),a("a-menu-item",{key:"仪表盘"},[a("a-icon",{attrs:{type:"dashboard"}}),e._v("创建仪表盘 ")],1)],1),a("div",[a("a-button",{staticStyle:{"margin-left":"5px",color:"#666","font-size":"16px"},attrs:{type:"link",icon:"plus"}})],1)],1)],1),a("div",{staticClass:"catalogue-tree"},[e.treeData.length>0?a("a-tree",{attrs:{"show-icon":"","tree-data":e.filteredTreeData,expandedKeys:e.defaultExpandedKeys,selectedKeys:e.defaultSelectedKeys},on:{expand:e.expandNode,select:e.selectNode,"update:expandedKeys":function(t){e.defaultExpandedKeys=t},"update:expanded-keys":function(t){e.defaultExpandedKeys=t},"update:selectedKeys":function(t){e.defaultSelectedKeys=t},"update:selected-keys":function(t){e.defaultSelectedKeys=t}},scopedSlots:e._u([{key:"folder",fn:function(e){var t=e.expanded;return[a("a-icon",{staticClass:"tree-icon",attrs:{theme:"outlined",type:t?"folder-open":"folder"}})]}},{key:"title",fn:function(t){return[t.folder?[e._v(e._s(t.title))]:a("a-tooltip",{attrs:{overlayClassName:"tooltip",placement:"right",overlayStyle:{background:"#fff"}}},[a("template",{slot:"title"},["dashboard"===e.item?[a("div",[e._v("名称："+e._s(t.title))]),a("div",[e._v("备注："+e._s(t.remarks))])]:e._e(),"workSheet"===e.item?[a("div",[e._v("名称："+e._s(t.title))]),a("div",[e._v("原名："+e._s(t.tableName))]),a("div",[e._v("描述："+e._s(t.description))])]:e._e()],2),e._v(" "+e._s(t.title)+" ")],2)]}}],null,!1,2447245915)},[a("a-icon",{staticClass:"tree-icon",attrs:{slot:e.item,theme:"outlined",type:e.treeIcon},slot:e.item})],1):e._e()],1)])]),a("a-col",{attrs:{xs:{span:17},xl:{span:19},xxl:{span:19}}},[a("div",{staticClass:"right-container"},[e.dashboardLoading?a("a-spin",{staticClass:"spin",attrs:{tip:"仪表盘加载中……"}}):[e._t("right-container")]],2)])],1),a("a-modal",{attrs:{title:"新建"+e.menuKey,visible:e.visible,"confirm-loading":e.confirmLoading,destroyOnClose:!0},on:{ok:e.handleOk,cancel:function(){e.visible=!1,e.form={parentId:""}}}},[a("a-form-model",e._b({model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},"a-form-model",{labelCol:{span:6},wrapperCol:{span:16}},!1),[a("a-form-model-item",{attrs:{label:"所属文件夹"}},[a("a-tree-select",{staticStyle:{width:"100%"},attrs:{"dropdown-style":{maxHeight:"400px",overflow:"auto"},"tree-data":e.selectedTreeData,"tree-default-expand-all":""},model:{value:e.form.parentId,callback:function(t){e.$set(e.form,"parentId",t)},expression:"form.parentId"}})],1),a("a-form-model-item",{attrs:{label:e.menuKey+"名称"}},[a("a-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),"仪表盘"==e.menuKey?a("a-form-model-item",{attrs:{label:e.menuKey+"备注"}},[a("a-input",{attrs:{type:"textarea"},model:{value:e.form.remarks,callback:function(t){e.$set(e.form,"remarks",t)},expression:"form.remarks"}})],1):e._e()],1)],1)],1)},i=[],s=(a("4de4"),a("4160"),a("caad"),a("d81d"),a("b0c0"),a("2532"),a("159b"),a("5530"));function o(e,t){localStorage.setItem(e,JSON.stringify(t))}function r(e){return JSON.parse(localStorage.getItem(e))}function l(e){return e.filter((function(e){return e.folder})).map((function(e){return Object(s["a"])(Object(s["a"])({},e),{},{selectable:!0,children:l(e.children)})}))}function c(e,t){var a=[];return e.forEach((function(e){if(e.isLeaf)e.title.includes(t)&&a.push(e);else{var n=Object(s["a"])(Object(s["a"])({},e),{},{children:c(e.children,t)});n.children.length>0&&a.push(n)}})),a}var d={props:["item"],data:function(){return{treeData:[],defaultExpandedKeys:[],defaultSelectedKeys:[],filterValue:"",visible:!1,confirmLoading:!1,menuKey:"",form:{parentId:""},dashboard:{},dashboardLoading:!0}},created:function(){this.init()},components:{},computed:{selectedKeysLocalKey:function(){return"".concat(this.item,"_selectedKeys")},expandedKeysLocalKey:function(){return"".concat(this.item,"_expandedKeys")},selectedRefIdKey:function(){return"".concat(this.item,"_ref_id")},filteredTreeData:function(){return c(this.treeData,this.filterValue)},selectedTreeData:function(){return l(this.treeData)},treeIcon:function(){return"workSheet"===this.item?"table":this.item}},methods:{init:function(){var e=this;this.defaultSelectedKeys=r(this.selectedKeysLocalKey),this.defaultExpandedKeys=r(this.expandedKeysLocalKey);var t=r(this.selectedRefIdKey);this.$axios.get("/".concat(this.item,"/catalogue")).then((function(a){var n=[{name:"根目录",id:0,refId:0,folder:!0,children:a}],i=n.map((function(t){return e.convert2Node(t)}));e.treeData=i,null!=t?e.chooseDashboard(t):e.dashboardLoading=!1}))},selectNode:function(e,t){var a=t.node;o(this.selectedKeysLocalKey,e),this.selectedKeys=e,a.dataRef.folder||(o(this.selectedRefIdKey,a.dataRef.refId),a.selected||this.chooseDashboard(a.dataRef.refId))},expandNode:function(e){o(this.expandedKeysLocalKey,e)},handleMenuClick:function(e){this.menuKey=e.key,this.visible=!0},chooseDashboard:function(e){this.dashboardLoading=!0,this.$emit("choose",e)},loaded:function(){this.dashboardLoading=!1},handleOk:function(){var e=this;if(""!==this.form.parentId){var t="/".concat(this.item);"文件夹"===this.menuKey&&(t+="/folder"),this.confirmLoading=!0,this.$axios.post(t,this.form).then((function(t){t&&(e.confirmLoading=!1,e.$message.success("创建".concat(e.menuKey,"成功！")),e.visible=!1,"文件夹"!==e.menuKey&&(o(e.selectedKeysLocalKey,["node_".concat(t.nodeId)]),o(e.selectedRefIdKey,t.dashboardId)),e.defaultExpandedKeys.push("node_".concat(e.form.parentId)),o(e.expandedKeysLocalKey,e.defaultExpandedKeys),e.init())})).catch((function(t){console.log(t),e.confirmLoading=!1}))}else this.$message.error("所属文件夹不能为空！")},convert2Node:function(e){var t=this,a=Object(s["a"])(Object(s["a"])({title:e.name},e),{},{key:"node_"+e.id,value:e.id,isLeaf:!e.folder||0===e.children.length,children:e.children.map((function(e){return t.convert2Node(e)})),selectable:!e.folder});return e.folder?a.scopedSlots={icon:"folder",title:"title"}:a.scopedSlots={icon:this.item,title:"title"},a}}},u=d,f=(a("6e4a"),a("2877")),h=Object(f["a"])(u,n,i,!1,null,null,null);t["a"]=h.exports},"6e4a":function(e,t,a){"use strict";var n=a("6a7e"),i=a.n(n);i.a},7680:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("catalogue",{ref:"catRef",attrs:{item:"workSheet"},on:{choose:e.chooseWorkSheet}},[a("template",{slot:"right-container"},[e.workSheet?a("work-sheet-detail",{attrs:{data:e.workSheet}}):e._e()],1)],2)],1)},i=[],s=a("6e21"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"work-sheet-detail-container"},[a("div",{staticClass:"work-sheet-header"},[a("div",{staticClass:"title"},[e._v(" "+e._s(e.data.title)+" "),a("div",{staticClass:"description"},[e._v(e._s(e.data.description||"该表没有描述，赶紧加上"))])]),a("div",{staticClass:"button-list"},[a("a-button",{attrs:{icon:"bar-chart"}},[e._v("新建图表")]),a("a-button",{attrs:{icon:"file-excel"}},[e._v("上传数据")]),a("a-button",{attrs:{icon:"share-alt"}},[e._v("创建合表")])],1)]),a("a-tabs",{staticClass:"tabs",attrs:{"default-active-key":"1"},on:{change:e.chooseTab}},[a("a-tab-pane",{key:"1",attrs:{tab:"数据预览"}},[a("preview",{attrs:{"work-sheet":e.data}})],1),a("a-tab-pane",{key:"2",attrs:{tab:"字段设置","force-render":""}},[a("field-list",{attrs:{data:e.data.fields}})],1)],1)],1)},r=[],l=a("6301"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-table",{attrs:{pagination:!1,size:"small","data-source":e.fieldsData,columns:e.columns}})],1)},d=[],u=(a("4de4"),[{title:"行数",dataIndex:"seqNo"},{title:"原字段名",dataIndex:"name"},{title:"新字段名",dataIndex:"title"},{title:"字段类型",dataIndex:"type",scopedSlots:{customRender:"type"}},{title:"字段描述",dataIndex:"remarks"}]),f={props:["data"],data:function(){return{columns:u}},computed:{fieldsData:function(){return this.data.filter((function(e){return"origin"===e.fieldType}))}}},h=f,p=a("2877"),m=Object(p["a"])(h,c,d,!1,null,null,null),v=m.exports,y={props:["data"],data:function(){return{tabKey:1}},components:{FieldList:v,Preview:l["a"]},methods:{chooseTab:function(){}}},b=y,x=(a("1688"),Object(p["a"])(b,o,r,!1,null,null,null)),k=x.exports,g={data:function(){return{workSheet:null}},components:{Catalogue:s["a"],WorkSheetDetail:k},methods:{chooseWorkSheet:function(e){var t=this;this.$axios.get("/workSheet?id=".concat(e)).then((function(e){t.workSheet=e,t.$refs.catRef.loaded()}))}}},_=g,K=Object(p["a"])(_,n,i,!1,null,null,null);t["default"]=K.exports},8092:function(e,t,a){},9464:function(e,t,a){},dd2d:function(e,t,a){"use strict";var n=a("9464"),i=a.n(n);i.a}}]);
//# sourceMappingURL=chunk-6e3bc08c.4a932e2f.js.map