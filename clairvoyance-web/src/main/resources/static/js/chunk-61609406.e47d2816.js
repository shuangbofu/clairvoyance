(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61609406"],{"0afa":function(t,a,e){"use strict";var i=e("2845"),r=e.n(i);r.a},2845:function(t,a,e){},6825:function(t,a,e){},7521:function(t,a,e){"use strict";var i=e("dcc5"),r=e.n(i);r.a},"8a8f":function(t,a,e){"use strict";var i=e("6825"),r=e.n(i);r.a},aade:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticStyle:{}},[e("a-page-header",{staticStyle:{border:"1px solid rgb(235, 237, 240)"},attrs:{title:"编辑图表"},on:{back:function(a){t.saveChart(),t.$router.go(-1)}}}),t.chart?e("div",{staticClass:"editor-main"},[e("div",{staticClass:"left-container"},[e("div",{staticStyle:{width:"100%"}},[e("a-select",{staticStyle:{width:"188px","margin-right":"10px"},model:{value:t.chart.workSheetId,callback:function(a){t.$set(t.chart,"workSheetId",a)},expression:"chart.workSheetId"}},t._l(t.workSheets,(function(a){return e("a-select-option",{key:a.workSheetId,attrs:{value:a.workSheetId}},[t._v(t._s(a.title))])})),1),e("a-button",{attrs:{icon:"eye"}})],1),e("div",{staticClass:"field-list"},[e("a-tabs",{staticStyle:{"margin-top":"10px"},attrs:{size:"small","default-active-key":"1"}},[e("a-tab-pane",{key:"1",attrs:{tab:"字段"}},[e("div",{staticClass:"field-origin-list"},t._l(t.fields,(function(a){return e("div",{key:a.name,staticClass:"field-item"},[t._v(t._s(a.title))])})),0)]),e("a-tab-pane",{key:"2",attrs:{tab:"参数"}})],1)],1)]),e("div",{staticClass:"chart-main"},[e("div",{staticClass:"chart-args"},[e("field-choose",{staticClass:"arg",attrs:{mode:"x",fields:t.fields,"arr-data":t.chart.sqlConfig.x},on:{save:t.saveChart}}),e("field-choose",{staticClass:"arg",attrs:{mode:"y",fields:t.fields,"arr-data":t.chart.sqlConfig.y},on:{save:t.saveChart}})],1),e("div",{staticStyle:{height:"calc(100vh - 230px)"}},[e("chart-box",{attrs:{chart:t.chart,data:t.chartData}})],1)]),e("right-controller",{attrs:{chart:t.chart},on:{refresh:t.saveChart}})],1):t._e()],1)},r=[],s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("div",{staticClass:"setting-button",on:{click:function(a){t.visible=!0}}},[e("a-icon",{staticClass:"icon",attrs:{type:"setting"}})],1),e("a-drawer",{attrs:{title:"设置",placement:"right",visible:t.visible,width:"500px"},on:{close:function(a){t.visible=!1}}},[e("a-form-model",[e("a-form-model-item",{attrs:{label:"图表标题"}},[e("a-input",{model:{value:t.chart.name,callback:function(a){t.$set(t.chart,"name",a)},expression:"chart.name"}})],1),e("a-form-model-item",{attrs:{label:"图表类型"}},[e("a-radio-group",{on:{change:t.changeChartType},model:{value:t.chart.chartType,callback:function(a){t.$set(t.chart,"chartType",a)},expression:"chart.chartType"}},t._l(t.chartTypes,(function(a){return e("a-radio-button",{key:a.name,attrs:{value:a.name}},[t._v(t._s(a.title))])})),1)],1)],1)],1)],1)},n=[],c=e("d1e9"),o={props:["chart"],data:function(){return{visible:!1,chartTypes:c["a"]}},methods:{changeChartType:function(){this.$emit("refresh")}}},l=o,h=(e("0afa"),e("2877")),u=Object(h["a"])(l,s,n,!1,null,null,null),d=u.exports,f=e("9677"),v=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"field-line"},[e("div",{staticClass:"title"},[t._v(t._s(t.title))]),t._l(t.arrData,(function(a,i){return e("div",{key:i,staticClass:"field-block"},[e("a-dropdown",[e("a-menu",{attrs:{slot:"overlay"},on:{click:function(e){return t.handleMenuClick(e,a)}},slot:"overlay"},[e("a-sub-menu",{key:"field",attrs:{title:"选择字段"}},t._l(t.fields,(function(a){return e("a-menu-item",{key:a.name},[t._v(t._s(a.title))])})),1),e("a-menu-item",{key:"3"},[t._v("设置字段")]),"y"===t.mode?e("a-sub-menu",{key:"aggregator",attrs:{title:"聚合函数"}},t._l(t.aggregatorFunc,(function(a,i){return e("a-menu-item",{key:i},[t._v(t._s(a))])})),1):t._e()],1),e("a-button",{staticStyle:{"margin-left":"8px"}},[t._v(" "+t._s(a.aggregator?a.title+" ("+t.aggregatorFunc[a.aggregator]+")":a.title)+" "),e("a-icon",{attrs:{type:"down"}})],1)],1),e("a-button",{staticStyle:{"margin-left":"-1px","font-size":"14px"},attrs:{icon:"close"},on:{click:function(a){return t.removeField(i)}}})],1)})),e("a-button",{staticClass:"add-button",attrs:{icon:"plus"},on:{click:t.addField}})],2)},g=[],m=(e("7db0"),e("a434"),e("b0c0"),e("5530")),p={SUM:"求和",AVG:"平均值",COUNT:"计数",DISTINCT_COUNT:"去重计数",MIN:"最小值",MAX:"最大值"},k=1,y={props:["mode","fields","arrData"],data:function(){return{aggregatorFunc:p}},computed:{title:function(){switch(this.mode){case"x":return"维度";case"y":return"数值";default:return""}}},methods:{addField:function(){this.arrData.push({name:"",title:"未选择",idx:k++})},removeField:function(t){this.arrData.splice(t,1),this.$emit("save")},handleMenuClick:function(t,a){var e=t.keyPath[1];"field"===e&&(Object.assign(a,Object(m["a"])({},this.fields.find((function(a){return a.name===t.key})))),"y"===this.mode&&(a.aggregator="value"===a.type?"SUM":"COUNT")),"aggregator"===e&&(a.aggregator=t.key),this.$emit("save")}}},b=y,C=(e("7521"),Object(h["a"])(b,v,g,!1,null,null,null)),_=C.exports,S={data:function(){return{chartId:"",chart:null,workSheets:[],chartData:[],fields:[],workSheetId:""}},created:function(){this.chartId=this.$route.query.chartId,this.workSheetId=this.$route.query.workSheetId,this.getWorkSheets(),this.initChart(),this.getWorkSheet()},components:{FieldChoose:_,ChartBox:f["a"],RightController:d},methods:{initChart:function(){var t=this;this.$axios.get("/chart?chartId=".concat(this.chartId)).then((function(a){t.chart=a,t.fetchChartData()}))},getWorkSheets:function(){var t=this;this.$axios.get("/workSheet/list").then((function(a){t.workSheets=a}))},getWorkSheet:function(){var t=this;this.$axios.get("/workSheet?id=".concat(this.workSheetId)).then((function(a){t.fields=a.fields}))},fetchChartData:function(){var t=this;this.$axios.get("/chart/data?chartId=".concat(this.chart.chartId)).then((function(a){t.chartData=a}))},saveChart:function(){var t=this;this.chart.chartType=this.chart.chartType||"UNKNOWN",this.$axios.post("/chart",this.chart).then((function(a){a&&t.initChart()}))}}},w=S,x=(e("8a8f"),Object(h["a"])(w,i,r,!1,null,null,null));a["default"]=x.exports},dcc5:function(t,a,e){}}]);
//# sourceMappingURL=chunk-61609406.e47d2816.js.map