(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61609406"],{"0afa":function(t,e,a){"use strict";var i=a("2845"),s=a.n(i);s.a},2845:function(t,e,a){},6825:function(t,e,a){},7521:function(t,e,a){"use strict";var i=a("dcc5"),s=a.n(i);s.a},"8a8f":function(t,e,a){"use strict";var i=a("6825"),s=a.n(i);s.a},aade:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{}},[a("a-page-header",{staticStyle:{border:"1px solid rgb(235, 237, 240)"},attrs:{title:"编辑图表"},on:{back:function(e){t.saveChart(),t.$router.go(-1)}}}),t.chart?a("div",{staticClass:"editor-main"},[a("div",{staticClass:"left-container"},[a("div",{staticStyle:{width:"100%"}},[a("a-select",{staticStyle:{width:"188px","margin-right":"10px"},model:{value:t.chart.workSheetId,callback:function(e){t.$set(t.chart,"workSheetId",e)},expression:"chart.workSheetId"}},t._l(t.workSheets,(function(e){return a("a-select-option",{key:e.workSheetId,attrs:{value:e.workSheetId}},[t._v(t._s(e.title))])})),1),a("a-button",{attrs:{icon:"eye"}})],1),a("div",{staticClass:"field-list"},[a("a-tabs",{staticStyle:{"margin-top":"10px"},attrs:{size:"small","default-active-key":"1"}},[a("a-tab-pane",{key:"1",attrs:{tab:"字段"}},[a("div",{staticClass:"field-origin-list"},t._l(t.fields,(function(e){return a("div",{key:e.name,staticClass:"field-item"},[t._v(t._s(e.title))])})),0)]),a("a-tab-pane",{key:"2",attrs:{tab:"参数"}})],1)],1)]),a("div",{staticClass:"chart-main"},[a("div",{staticClass:"chart-args"},[a("field-choose",{staticClass:"arg",attrs:{mode:"x",fields:t.fields,"arr-data":t.chart.sqlConfig.x,"sql-config":t.chart.sqlConfig},on:{save:t.saveChart}}),a("field-choose",{staticClass:"arg",attrs:{mode:"y",fields:t.fields,"arr-data":t.chart.sqlConfig.y,"sql-config":t.chart.sqlConfig},on:{save:t.saveChart}})],1),a("div",{staticStyle:{height:"calc(100vh - 230px)",display:"flex"}},[a("div",{staticClass:"chart-filter-container"}),a("chart-box",{staticClass:"chart-box",attrs:{chart:t.chart,data:t.chartData}})],1)]),a("right-controller",{attrs:{chart:t.chart},on:{refresh:t.saveChart}})],1):t._e()],1)},s=[],n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"setting-button",on:{click:function(e){t.visible=!0}}},[a("a-icon",{staticClass:"icon",attrs:{type:"setting"}})],1),a("a-drawer",{attrs:{title:"设置",placement:"right",visible:t.visible,width:"500px"},on:{close:function(e){t.visible=!1}}},[a("a-form-model",[a("a-form-model-item",{attrs:{label:"图表标题"}},[a("a-input",{model:{value:t.chart.name,callback:function(e){t.$set(t.chart,"name",e)},expression:"chart.name"}})],1),a("a-form-model-item",{attrs:{label:"图表类型"}},[a("a-radio-group",{on:{change:t.changeChartType},model:{value:t.chart.chartType,callback:function(e){t.$set(t.chart,"chartType",e)},expression:"chart.chartType"}},t._l(t.chartTypes,(function(e){return a("a-radio-button",{key:e.name,attrs:{value:e.name}},[t._v(t._s(e.title))])})),1)],1)],1)],1)],1)},r=[],l=a("d1e9"),c={props:["chart"],data:function(){return{visible:!1,chartTypes:l["a"]}},methods:{changeChartType:function(){this.$emit("refresh")}}},o=c,h=(a("0afa"),a("2877")),d=Object(h["a"])(o,n,r,!1,null,null,null),u=d.exports,f=a("9677"),m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"field-line"},[a("div",{staticClass:"title"},[t._v(t._s(t.title))]),t._l(t.arrData,(function(e,i){return a("div",{key:i,staticClass:"field-block"},[a("a-dropdown",[a("a-menu",{attrs:{slot:"overlay"},on:{click:function(a){return t.handleMenuClick(a,e)}},slot:"overlay"},[a("a-sub-menu",{key:"field",attrs:{title:"选择字段"}},t._l(t.fields,(function(e){return a("a-menu-item",{key:e.name},[t._v(t._s(e.title))])})),1),a("a-menu-item",{key:"3",on:{click:function(e){return t.setField(i)}}},[t._v("设置字段")]),"y"===t.mode?a("a-sub-menu",{key:"aggregator",attrs:{title:"聚合函数"}},t._l(t.aggregatorFunc,(function(e,i){return a("a-menu-item",{key:i},[t._v(t._s(e))])})),1):t._e(),a("a-sub-menu",{key:"sort",attrs:{title:"排序"}},t._l(t.sortMenus,(function(i){return a("a-menu-item",{key:i.name,on:{click:function(a){return t.setSort(e,i.name)}}},[t._v(t._s(i.title))])})),1)],1),a("a-button",{staticStyle:{"margin-left":"8px"}},[t.sqlConfig.sort&&t.sqlConfig.sort.name===e.name?a("a-icon",{staticStyle:{"margin-right":"5px"},attrs:{type:"sort-"+t.sqlConfig.sort.orderType+"ending"}}):t._e(),t._v(" "+t._s(e.finalAliasName)+" "),a("a-icon",{attrs:{type:"down"}})],1)],1),a("a-button",{staticStyle:{"margin-left":"-1px","font-size":"14px"},attrs:{icon:"close"},on:{click:function(e){return t.removeField(i)}}})],1)})),a("a-modal",{attrs:{destroyOnClose:!0,visible:t.settingFieldVisible,width:400,title:"修改字段"},on:{cancel:function(){t.settingFieldVisible=!1,t.form={}},ok:t.finishSetField}},[a("a-form-model-item",{attrs:{label:"字段别名"}},[a("a-input",{model:{value:t.settingField.aliasName,callback:function(e){t.$set(t.settingField,"aliasName",e)},expression:"settingField.aliasName"}})],1),a("a-form-model-item",{attrs:{label:"字段描述"}},[a("a-input",{attrs:{type:"textarea"},model:{value:t.settingField.description,callback:function(e){t.$set(t.settingField,"description",e)},expression:"settingField.description"}})],1)],1),a("a-button",{staticClass:"add-button",attrs:{icon:"plus"},on:{click:t.addField}})],2)},g=[],v=(a("7db0"),a("a434"),a("b0c0"),a("5530")),p=[{name:"default",title:"默认"},{name:"asc",title:"升序"},{name:"desc",title:"降序"}],k={SUM:"求和",AVG:"平均值",COUNT:"计数",DISTINCT_COUNT:"去重计数",MIN:"最小值",MAX:"最大值"},y=1,C={props:["mode","fields","arrData","sqlConfig"],data:function(){return{sortMenus:p,aggregatorFunc:k,settingField:{},settingFieldVisible:!1,settingFieldIndex:""}},computed:{title:function(){switch(this.mode){case"x":return"维度";case"y":return"数值";default:return""}}},methods:{addField:function(){this.arrData.push({name:"",title:"未选择",idx:y++})},removeField:function(t){this.arrData.splice(t,1),this.saveChart()},handleMenuClick:function(t,e){var a=t.keyPath[1];"sort"!==a&&("field"===a&&(Object.assign(e,Object(v["a"])({},this.fields.find((function(e){return e.name===t.key})))),"y"===this.mode&&(e.aggregator="value"===e.type?"SUM":"COUNT")),"aggregator"===a&&(e.aggregator=t.key),this.saveChart())},setField:function(t){this.settingFieldVisible=!0,this.settingFieldIndex=t,this.settingField=this.arrData[t]},finishSetField:function(){Object.assign(this.arrData[this.settingFieldIndex],this.settingField),this.settingFieldVisible=!1,this.saveChart()},setSort:function(t,e){var a="default"===e?null:{name:t.name,orderType:e};this.sqlConfig.sort=a,this.saveChart()},saveChart:function(){this.$emit("save")}}},b=C,x=(a("7521"),Object(h["a"])(b,m,g,!1,null,null,null)),S=x.exports,_={data:function(){return{chartId:"",chart:null,workSheets:[],chartData:[],fields:[],workSheetId:""}},created:function(){this.chartId=this.$route.query.chartId,this.workSheetId=this.$route.query.workSheetId,this.getWorkSheets(),this.initChart(),this.getWorkSheet()},components:{FieldChoose:S,ChartBox:f["a"],RightController:u},methods:{initChart:function(){var t=this;this.$axios.get("/chart?chartId=".concat(this.chartId)).then((function(e){t.chart=e,t.fetchChartData()}))},getWorkSheets:function(){var t=this;this.$axios.get("/workSheet/list").then((function(e){t.workSheets=e}))},getWorkSheet:function(){var t=this;this.$axios.get("/workSheet?id=".concat(this.workSheetId)).then((function(e){t.fields=e.fields}))},fetchChartData:function(){var t=this;this.$axios.get("/chart/data?chartId=".concat(this.chart.chartId)).then((function(e){t.chartData=e}))},saveChart:function(){var t=this;this.chart.chartType=this.chart.chartType||"UNKNOWN",this.$axios.post("/chart",this.chart).then((function(e){e&&t.initChart()}))}}},w=_,F=(a("8a8f"),Object(h["a"])(w,i,s,!1,null,null,null));e["default"]=F.exports},dcc5:function(t,e,a){}}]);
//# sourceMappingURL=chunk-61609406.9b4e5c3a.js.map